# Stop unexpected content negotiation
Options -MultiViews

RewriteEngine On

# --- Always serve real files/dirs as-is ---
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# --- Whitelist things that must never hit the router ---
# add more if needed (humans.txt, security.txt, etc.)
RewriteRule ^(sitemap.*\.xml|robots\.txt|favicon\.ico)$ - [L]

# --- Matrix landing pages ---
RewriteRule ^matrix/(.+)$ matrix-router.php [L,QSA]

# --- Force HTTPS (optional) ---
# Make sure to EXEMPT the whitelisted files to prevent loops
#RewriteCond %{HTTPS} !=on
#RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# --- Trailing slash normalization (optional) ---
# Avoid applying to files like .xml/.ico
#RewriteCond %{REQUEST_FILENAME} !-f
#RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,4}$
#RewriteRule ^(.+[^/])$ /$1/ [R=301,L]

# --- Front controller: everything else to index.php ---
RewriteRule ^ index.php [L]