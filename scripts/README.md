# Scripts Directory

## Schema Validation Scripts

### `validate_matrix_schema.php`

Validates that every URL in `public/sitemap-matrix.xml` contains proper JSON-LD structured data.

**What it checks:**
- ✅ **LocalBusiness** schema (required on all pages)
- ✅ **Service** schema (required on all pages)
- ✅ **FAQPage** schema (required only if page contains FAQ section)

**Requirements:**
- PHP 7.4+ with cURL extension
- `public/sitemap-matrix.xml` must exist (generated by `src/generate-matrix-sitemap.php`)
- Website must be live and accessible (script fetches URLs via HTTP)

**Usage:**

```bash
# Run validation against your live production site
php scripts/validate_matrix_schema.php
```

**Output:**

The script will:
1. Parse `public/sitemap-matrix.xml` to extract all URLs (~10,500 URLs)
2. Fetch each URL via HTTP/HTTPS
3. Check for required JSON-LD schema types
4. Display progress with status for each URL
5. Generate `schema_validation_report.csv` if any failures found

**Example output:**

```
Validating 10500 URLs...
[1/10500] https://www.hoosiercladding.com/matrix/south-bend-in/siding-repair/storm-damage  HTTP:200  LB:OK  Service:OK  FAQ:OK
[2/10500] https://www.hoosiercladding.com/matrix/south-bend-in/siding-repair/hail-damage  HTTP:200  LB:OK  Service:OK  FAQ:OK
[3/10500] https://www.hoosiercladding.com/matrix/south-bend-in/siding-repair/wind-damage  HTTP:200  LB:MISS  Service:OK  FAQ:OK  <-- FIX
...
```

**Exit codes:**
- `0` - All URLs passed validation ✅
- `1` - Sitemap file not found or invalid ❌
- `2` - One or more URLs failed validation (see CSV report) ⚠️

**Performance notes:**
- Each URL is fetched individually (no parallelization)
- 20-second timeout per URL
- ~10,500 URLs will take **2-3 hours** to complete
- Consider running in a screen/tmux session for long runs

**Validation report:**

If failures are found, a CSV report is generated: `schema_validation_report.csv`

Columns:
- `url` - The failing URL
- `http` - HTTP status code
- `LocalBusiness` - OK or MISS
- `Service` - OK or MISS
- `FAQPage` - OK, MISS, or N/A (if FAQ not required)

**Prerequisites:**

Before running, ensure:
1. Matrix sitemap is generated:
   ```bash
   php src/generate-matrix-sitemap.php
   ```

2. Sitemap is copied to public directory:
   ```bash
   cp sitemap-matrix.xml public/
   ```

3. Website is deployed and accessible at production URL

**Testing locally:**

To test against a local Docker instance:
1. Update `$baseUrl` in the script to `http://localhost:8080`
2. Start Docker: `docker-compose up`
3. Run validation: `php scripts/validate_matrix_schema.php`

**Common issues:**

1. **"Sitemap not found"**
   - Run: `php src/generate-matrix-sitemap.php`
   - Copy: `cp sitemap-matrix.xml public/`

2. **"HTTP:0" or connection errors**
   - Check if site is accessible
   - Verify SSL certificates (if HTTPS)
   - Check firewall/rate limiting

3. **"MISS" for schema types**
   - Check matrix page template includes JSON-LD
   - Verify schema renderer is working
   - Test one URL manually with browser dev tools

**Integration with CI/CD:**

Add to your deployment pipeline:

```yaml
# .github/workflows/deploy.yml
- name: Validate Schema
  run: php scripts/validate_matrix_schema.php
  continue-on-error: true  # Don't block deployment on failures
```

**Related scripts:**
- `src/generate-matrix-sitemap.php` - Generate the sitemap
- `src/generate-sitemap.php` - Generate regular sitemap
- `src/generate-landing-pages.php` - Generate landing page HTML

